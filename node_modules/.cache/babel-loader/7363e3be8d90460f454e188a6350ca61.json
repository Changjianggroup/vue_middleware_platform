{"remainingRequest":"/data/software/vue_middleware_platform/node_modules/thread-loader/dist/cjs.js!/data/software/vue_middleware_platform/node_modules/babel-loader/lib/index.js!/data/software/vue_middleware_platform/node_modules/cache-loader/dist/cjs.js??ref--0-0!/data/software/vue_middleware_platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/data/software/vue_middleware_platform/src/components/page/audit/dbcrud/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/data/software/vue_middleware_platform/src/components/page/audit/dbcrud/index.vue","mtime":1610812226842},{"path":"/data/software/vue_middleware_platform/node_modules/cache-loader/dist/cjs.js","mtime":1609060265603},{"path":"/data/software/vue_middleware_platform/node_modules/thread-loader/dist/cjs.js","mtime":1609060265532},{"path":"/data/software/vue_middleware_platform/node_modules/babel-loader/lib/index.js","mtime":1609060265632},{"path":"/data/software/vue_middleware_platform/node_modules/cache-loader/dist/cjs.js","mtime":1609060265603},{"path":"/data/software/vue_middleware_platform/node_modules/vue-loader/lib/index.js","mtime":1609060265552}],"contextDependencies":[],"result":["import \"core-js/modules/es6.date.now\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getDBCRUDList } from '@/api/audit';\nimport { getUserList } from '@/api/users';\nimport { formatJson } from '@/utils';\nexport default {\n  name: 'DBCRUDinfor',\n  data: function data() {\n    return {\n      // 遮罩层\n      loading: true,\n      // 选中数组\n      ids: [],\n      // 非多个禁用\n      multiple: true,\n      // 查询用户\n      username: '',\n      // 总条数\n      total: 0,\n      // 表格数据\n      list: [],\n      // 用户数据\n      userList: [],\n      // 状态数据字典\n      statusOptions: [],\n      // 查询参数\n      queryParams: {\n        page: 1,\n        page_size: 10,\n        event_type: undefined,\n        user_id: undefined\n      },\n      event_type_options: [{\n        value: '1',\n        label: 'CREATE'\n      }, {\n        value: '2',\n        label: 'UPDATE'\n      }, {\n        value: '3',\n        label: 'DELETE'\n      }, {\n        value: '4',\n        label: 'Many-to-Many CHANGE'\n      }, {\n        value: '5',\n        label: 'Reverse Many-to-Many Change'\n      }],\n      event_type_value: '',\n      start_date: '',\n      end_date: '',\n      pickerOptions: {\n        disabledDate: function disabledDate(time) {\n          return time.getTime() > Date.now();\n        },\n        shortcuts: [{\n          text: '今天',\n          onClick: function onClick(picker) {\n            picker.$emit('pick', new Date());\n          }\n        }, {\n          text: '昨天',\n          onClick: function onClick(picker) {\n            var date = new Date();\n            date.setTime(date.getTime() - 3600 * 1000 * 24);\n            picker.$emit('pick', date);\n          }\n        }, {\n          text: '一周前',\n          onClick: function onClick(picker) {\n            var date = new Date();\n            date.setTime(date.getTime() - 3600 * 1000 * 24 * 7);\n            picker.$emit('pick', date);\n          }\n        }]\n      }\n    };\n  },\n  created: function created() {\n    this.getUser();\n    this.getList(); // this.getDicts('sys_common_status').then(response => {\n    //     this.statusOptions = response.data\n    // })\n  },\n  methods: {\n    /** 查询数据库变更记录 */\n    getList: function getList() {\n      var _this = this;\n\n      this.loading = true;\n      getDBCRUDList(this.queryParams).then(function (response) {\n        _this.list = response.results;\n\n        for (var i in _this.list) {\n          _this.list[i]['num'] = parseInt(i) + 1;\n        }\n\n        _this.total = response.count;\n        _this.loading = false;\n      });\n    },\n\n    /** 获取用户列表 */\n    getUser: function getUser() {\n      var _this2 = this;\n\n      getUserList().then(function (response) {\n        _this2.userList = response.results;\n      });\n    },\n\n    /** 搜索按钮操作 */\n    handleQuery: function handleQuery() {\n      this.queryParams.page = 1;\n      this.queryParams.user_id = undefined;\n\n      for (var i in this.userList) {\n        if (this.username === this.userList[i]['username']) {\n          this.queryParams.user_id = this.userList[i]['id'];\n        }\n      }\n\n      this.queryParams.event_type = this.event_type_value;\n      this.getList();\n    },\n\n    /** 重置按钮操作 */\n    resetQuery: function resetQuery() {\n      this.dateRange = [];\n      this.event_type_value = '';\n      this.username = '';\n      this.queryParams.event_type = '';\n      this.queryParams.user_id = '';\n      this.handleQuery();\n    },\n\n    /** 转换数据库状态为中文 */\n    formateventType: function formateventType(row, column) {\n      if (row.event_type === 1) {\n        return \"CREATE\";\n      } else if (row.event_type === 2) {\n        return \"UPDATE\";\n      } else if (row.event_type === 3) {\n        return \"DELETE\";\n      } else if (row.event_type === 4) {\n        return \"Many-to-Many CHANGE\";\n      } else if (row.event_type === 5) {\n        return \"Reverse Many-to-Many Change\";\n      }\n    },\n\n    /** 转换用户id状态为用户名 */\n    formatuserID: function formatuserID(row, column) {\n      var val = '';\n\n      for (var i in this.userList) {\n        if (row.user_id === this.userList[i]['id']) {\n          val = this.userList[i]['username'];\n        }\n      }\n\n      return val;\n    },\n\n    /** 导出按钮操作 */\n    handleExport: function handleExport() {\n      var _this3 = this;\n\n      // const queryParams = this.queryParams\n      this.$confirm('是否确认导出现在的数据库操作记录表单?', '警告', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _this3.downloadLoading = true;\n        import('@/utils/Export2Excel').then(function (excel) {\n          var tHeader = ['编号', '用户编号', '用户名称', '登陆IP', '登陆状态', '登陆日期'];\n          var filterVal = ['num', 'user_id', 'username', 'remote_ip', 'login_type', 'datetime'];\n          var list = _this3.list;\n          var data = formatJson(filterVal, list);\n          excel.export_json_to_excel({\n            header: tHeader,\n            data: data,\n            filename: 'DB操作日志',\n            autoWidth: true,\n            // Optional\n            bookType: 'xlsx' // Optional\n\n          });\n          _this3.downloadLoading = false;\n        });\n      });\n    }\n  }\n};",null]}