{"remainingRequest":"/data/software/vue_middleware_platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/data/software/vue_middleware_platform/src/components/page/audit/request/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/data/software/vue_middleware_platform/src/components/page/audit/request/index.vue","mtime":1610812272142},{"path":"/data/software/vue_middleware_platform/node_modules/babel-loader/lib/index.js","mtime":1609060265632},{"path":"/data/software/vue_middleware_platform/node_modules/cache-loader/dist/cjs.js","mtime":1609060265603},{"path":"/data/software/vue_middleware_platform/node_modules/vue-loader/lib/index.js","mtime":1609060265552}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { getRequestList } from '@/api/audit'\nimport { getUserList } from '@/api/users'\nimport { formatJson } from '@/utils'\nexport default {\n    name: 'Requestinfor',\n    data() {\n        return {\n            // 遮罩层\n            loading: true,\n            // 选中数组\n            ids: [],\n            // 非多个禁用\n            multiple: true,\n            // 查询用户\n            username: '',\n            // 总条数\n            total: 0,\n            // 表格数据\n            list: [],\n            // 用户数据\n            userList: [],\n            // 状态数据字典\n            statusOptions: [],\n            // 查询参数\n            queryParams: {\n                page: 1,\n                page_size: 10,\n                user_id: undefined,\n                remote_ip: undefined\n            },\n          start_date: '',\n          end_date: '',\n          pickerOptions: {\n            disabledDate(time) {\n              return time.getTime() > Date.now();\n            },\n            shortcuts: [{\n              text: '今天',\n              onClick(picker) {\n                picker.$emit('pick', new Date());\n              }\n            }, {\n              text: '昨天',\n              onClick(picker) {\n                const date = new Date();\n                date.setTime(date.getTime() - 3600 * 1000 * 24);\n                picker.$emit('pick', date);\n              }\n            }, {\n              text: '一周前',\n              onClick(picker) {\n                const date = new Date();\n                date.setTime(date.getTime() - 3600 * 1000 * 24 * 7);\n                picker.$emit('pick', date);\n              }\n            }]\n          }, \n        }\n    },\n    created() {\n        this.getUser()\n        this.getList()\n        // this.getDicts('sys_common_status').then(response => {\n        //     this.statusOptions = response.data\n        // })\n    },\n    methods: {\n        /** 查询数据库变更记录 */\n        getList() {\n            this.loading = true\n            getRequestList(this.queryParams).then(response => {\n                    this.list = response.results\n                    for (let i in this.list) {\n                        this.list[i]['num'] = parseInt(i) + 1\n                    }\n                    this.total = response.count\n                    this.loading = false\n                }\n            )\n\n        },\n        /** 获取用户列表 */\n        getUser() {\n            getUserList().then(response => {\n                    this.userList = response.results\n                }\n            )\n        },\n        /** 搜索按钮操作 */\n        handleQuery() {\n            this.queryParams.page = 1\n            this.queryParams.user_id = undefined\n            for (let i in this.userList) {\n                if (this.username === this.userList[i]['username']) {\n                    this.queryParams.user_id = this.userList[i]['id']\n                }\n            }\n            this.queryParams.event_type = this.event_type_value\n            this.getList()\n        },\n        /** 重置按钮操作 */\n        resetQuery() {\n            this.username = ''\n            this.queryParams.remote_ip = ''\n            this.queryParams.user_id = ''\n            this.handleQuery()\n        },\n        /** 转换用户id状态为用户名 */\n        formatuserID(row, column) {\n            let val = ''\n            for (let i in this.userList) {\n                if (row.user_id === this.userList[i]['id']) {\n                    val = this.userList[i]['username']\n                }\n            }\n            return val\n        },\n        /** 导出按钮操作 */\n        handleExport() {\n            // const queryParams = this.queryParams\n            this.$confirm('是否确认导出API请求数据表单?', '警告', {\n                confirmButtonText: '确定',\n                cancelButtonText: '取消',\n                type: 'warning'\n            }).then(() => {\n                this.downloadLoading = true\n                import('@/utils/Export2Excel').then(excel => {\n                    const tHeader = ['编号', 'id', '请求相对路径','请求方法', '请求参数','提交数据', '请求IP地址', '操作时间','用户ID','用户名']\n                    const filterVal = ['num', 'id','url', 'remote_ip', 'method', 'query_string', 'post_data','datetime','user_id', 'username']\n                    for (let i in this.list ) {\n                        for ( let j in this.userList){\n                            if (this.list[i]['user_id'] === this.userList[j]['id']) {\n                                this.list[i]['username'] = this.userList[j]['username']\n                        }\n                        }\n                    }\n                    const list = this.list\n                    const data = formatJson(filterVal, list)\n                    excel.export_json_to_excel({\n                        header: tHeader,\n                        data,\n                        filename: 'API请求日志',\n                        autoWidth: true, // Optional\n                        bookType: 'xlsx' // Optional\n                    })\n                    this.downloadLoading = false\n                })\n            })\n        }\n    }\n}\n",null]}