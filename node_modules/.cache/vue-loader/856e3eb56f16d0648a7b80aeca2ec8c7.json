{"remainingRequest":"/data/software/vue_middleware_platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/data/software/vue_middleware_platform/src/components/page/perm/groups/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/data/software/vue_middleware_platform/src/components/page/perm/groups/index.vue","mtime":1607932802579},{"path":"/data/software/vue_middleware_platform/node_modules/babel-loader/lib/index.js","mtime":1607932810881},{"path":"/data/software/vue_middleware_platform/node_modules/cache-loader/dist/cjs.js","mtime":1607932810847},{"path":"/data/software/vue_middleware_platform/node_modules/vue-loader/lib/index.js","mtime":1607932810803}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { getGroupList, createGroup, updateGroup, deleteGroup, deleteGroupMember, getPermission, updateGroupPerm } from '@/api/groups'\nimport GroupList from './group-list'\nimport GroupForm from './group-form'\nimport GroupMember from './group-member'\nimport GroupPerm from './group-perm'\n\nexport default {\n  name: 'Group',\n  components: { GroupList, GroupForm, GroupMember, GroupPerm },\n  data() {\n    return {\n      groupForms: [],\n      group: [],\n      member: [],\n      permsList: [],\n      groupname: '',\n      perDialogTitle: '',\n      groupid: '',\n      groupPerms: [],\n      dialogVisibleCreate: false,\n      dialogVisibleUpdate: false,\n      dialogVisibleUser: false,\n      dialogVisiblePerm: false,\n      loading: true,\n      detailForm: {},\n      createString: '立即创建',\n      updateString: '立即更新',\n      totalNum: 0,\n      currentPage1: 1,\n      params: {\n        page: 1,\n        name: '',\n        page_size: 10\n      }\n    }\n  },\n  created() {\n    this.fetchData()\n  },\n  methods: {\n    fetchData() {\n      getGroupList(this.params).then(\n        // 获取所有用户组\n        res => {\n          this.group = res.results\n          this.totalNum = res.count\n          this.loading = false\n        },\n        error => {\n          this.$message({\n            type: 'error',\n            message: error\n          })\n        }\n      )\n    },\n    handleSubmitCreate(value) {\n      // 创建用户组\n      createGroup(value).then(\n        () => {\n          this.fetchData()\n          this.$refs.gform.$refs.form.resetFields()\n          this.dialogVisibleCreate = false\n          this.$message({\n            type: 'success',\n            message: '创建成功'\n          })\n        },\n        error => {\n          this.$message({\n            type: 'error',\n            message: error.response\n          })\n        }\n      )\n    },\n    handleSubmitUpdate(value) {\n      // 编辑更新用户组\n      updateGroup(value).then(\n        () => {\n          this.fetchData()\n          this.dialogVisibleUpdate = false\n          this.$message({\n            type: 'success',\n            message: '更新成功'\n          })\n        },\n        err => {\n          this.$message({\n            type: 'error',\n            message: err.response.data.detail\n          })\n        })\n    },\n    handleEditPerm(value) {\n      // 更新用户组的权限\n      this.groupForms = value\n      this.dialogVisiblePerm = true\n      getPermission().then(\n        res => {\n          this.permsList = res\n        },\n        err => {\n          this.$message({\n            type: 'error',\n            message: err.response.data.detail\n          })\n        }\n      )\n      this.perDialogTitle = value.name + '组权限修改'\n      this.groupPerms = value.perm.map(item => item.id)\n    },\n    handleUpdate(value) {\n      // 弹出用户组更新对话框\n      this.dialogVisibleUpdate = true\n      this.detailForm = value\n    },\n    handleDelete(id) {\n      // 删除用户组\n      deleteGroup(id).then(\n        () => {\n          if (this.totalNum % this.params.page_size === 1) {\n            this.params.page = this.params.page - 1\n          }\n          this.fetchData()\n          this.$message({\n            type: 'success',\n            message: '删除成功!'\n          })\n        },\n        err => {\n          this.$message({\n            type: 'error',\n            message: err.response.data.detail\n          })\n        }\n      )\n    },\n    handleSubmitGroupPerm(id, value) {\n      // 更新用户组权限\n      updateGroupPerm(id, value).then(\n        () => {\n          this.dialogVisiblePerm = false\n          this.fetchData()\n          this.$message({\n            type: 'success',\n            message: '更新成功'\n          })\n        })\n      this.$refs.permform.$refs.trans.clearQuery('left')\n      this.$refs.permform.$refs.trans.clearQuery('right')\n    },\n    handlelistMember(value) {\n      // 获取用户组成员列表\n      this.groupname = value.name + '组成员列表'\n      this.dialogVisibleUser = true\n      this.member = value.users\n      this.groupid = value.id\n    },\n    handleDeleteGroupMember(value) {\n      // 删除用户组成员\n      console.log(this.groupid)\n      deleteGroupMember(this.groupid, value).then(\n        () => {\n          this.dialogVisibleUser = false\n          this.fetchData()\n          this.$message({\n            type: 'success',\n            message: '删除成功!'\n          })\n        },\n        err => {\n          this.$message({\n            type: 'error',\n            message: err.response.data.detail\n          })\n        }\n      )\n    },\n    handleCurrentChange(val) {\n      // 分页跳转\n      this.params.page = val\n      this.fetchData()\n    },\n    handleFilter() {\n      // 用户组搜索功能\n      this.params.page = 1\n      this.fetchData()\n    },\n    handleCreateCancel() {\n      // 对话框取消实现\n      this.dialogVisibleCreate = false\n      this.fetchData()\n    },\n    handleUpdateCancel() {\n      // 对话框取消实现\n      this.dialogVisibleUpdate = false\n      this.fetchData()\n    },\n    handlePermCancel() {\n      // 对话框取消实现\n      this.dialogVisiblePerm = false\n      this.$refs.permform.$refs.trans.clearQuery('left')\n      this.$refs.permform.$refs.trans.clearQuery('right')\n      this.fetchData()\n    }\n  }\n}\n\n",null]}