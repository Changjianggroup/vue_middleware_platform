{"remainingRequest":"/data/software/vue_middleware_platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/data/software/vue_middleware_platform/src/components/page/redisManagement/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/data/software/vue_middleware_platform/src/components/page/redisManagement/index.vue","mtime":1608006572213},{"path":"/data/software/vue_middleware_platform/node_modules/cache-loader/dist/cjs.js","mtime":1608006587548},{"path":"/data/software/vue_middleware_platform/node_modules/thread-loader/dist/cjs.js","mtime":1608006587505},{"path":"/data/software/vue_middleware_platform/node_modules/babel-loader/lib/index.js","mtime":1608006587572},{"path":"/data/software/vue_middleware_platform/node_modules/cache-loader/dist/cjs.js","mtime":1608006587548},{"path":"/data/software/vue_middleware_platform/node_modules/vue-loader/lib/index.js","mtime":1608006587518}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { getServerList, createServer, deleteServer, updateServer } from '@/api/redis_server'\n// import { getSupplierList } from '@/api/supplier'\n// import { getManufactoryList } from '@/api/manufactory'\n// import { getIdcList } from '@/api/idc'\n\nimport ServerList from './list'\nimport ServerForm from './form'\n\nexport default {\n  name: 'redisManagement',\n  components: { ServerList, ServerForm },\n  data() {\n    return {\n      serverid: '',\n      server: [],\n      multipleSelection: [],\n      manufactoryOption: [],\n      serverOption: [],\n      dialogVisibleCreate: false,\n      dialogVisibleUpdate: false,\n      updateServerInfo: {},\n      serverInfo: {},\n      // detailForm: {},\n      createString: '立即创建',\n      updateString: '立即更新',\n      totalNum: 0,\n      currentPage1: 1,\n      params: {\n        page: 1,\n        keywords: '',\n        page_size: 10\n      },\n      cluster_name_list: [],\n      cluster_name_options: []\n    }\n  },\n  created() {\n    this.fetchData()\n  },\n  methods: {\n    fetchData() {\n      getServerList(this.params).then(\n          // 获取redis集群列表\n          res => {\n            this.server = res.results\n            this.totalNum = res.count\n          },\n          err => {\n            this.$message({\n              type: 'error',\n              message: err\n            })\n          }\n      )\n    },\n    handleSubmitCreate(value) {\n      // 创建服务器\n      createServer(value).then(\n          () => {\n            this.fetchData()\n            this.dialogVisibleCreate = false\n            this.$refs.serverCreateForm.form.resetFields().catch(err => {})\n            this.$message({\n              type: 'success',\n              message: '创建成功'\n            })\n          },\n          error => {\n            this.$message({\n              type: 'error',\n              message: error\n            })\n          }\n      )\n    },\n    handleSubmitUpdate(value) {\n      // 更新服务器\n      updateServer(value).then(\n          () => {\n            this.fetchData()\n            this.dialogVisibleUpdate = false\n            this.$message({\n              type: 'success',\n              message: '更新成功'\n            })\n          },\n          err => {\n            this.$message({\n              type: 'error',\n              message: err.response\n            })\n          })\n    },\n    handleDialogCreate() {\n      // 弹出服务器新增弹框\n      this.dialogVisibleCreate = true\n    },\n    handleDialogUpdate(server_obj) {\n      this.serverInfo = server_obj\n      this.dialogVisibleUpdate = true\n    },\n    closedUpdateDialog() {\n      // this.reset = false\n    },\n    handleDeleteServer(id) {\n      // 删除Server\n      deleteServer(id).then(\n          () => {\n            if (this.totalNum % this.params.page_size === 1) {\n              this.params.page = this.params.page - 1\n            }\n            this.fetchData()\n            this.$message({\n              type: 'success',\n              message: '删除成功!'\n            })\n          },\n          err => {\n            this.$message({\n              type: 'error',\n              message: err\n            })\n          }\n      )\n    },\n    handleOpertionServer(id) {\n      // 操作redis 查询、删除等操作\n      this.$store.state.redis.server_id = id\n      this.$router.push({\n        path: '/redis/operation'\n      })\n    },\n    handleCurrentChange(val) {\n      // 分页\n      this.params.page = val\n      this.fetchData()\n    },\n    handleSizeChange(val) {\n      // 改变分页大小\n      this.params.page_size = val\n      this.fetchData()\n    },\n    handleCreateCancel() {\n      // 取消创建\n      this.dialogVisibleCreate = false\n      this.fetchData()\n    },\n    handleUpdateCancel() {\n      // 取消更新\n      this.dialogVisibleUpdate = false\n      this.fetchData()\n    },\n    handleFilter() {\n      // 搜索\n      this.params.page = 1\n      this.fetchData()\n    },\n    handleSelectionChange(val) {\n      // 获取表格多选的值\n      this.multipleSelection = val\n    },\n    handleMultiDeleteServer() {\n      // 批量删除\n      if ((this.totalNum - this.multipleSelection.length) % this.params.page_size === 0) {\n        this.params.page = this.params.page - 1\n      }\n      this.multipleSelection.forEach(\n          (item) => {\n            deleteServer(item.id).then(\n                () => {\n                  this.fetchData()\n                  this.$message({\n                    type: 'success',\n                    message: '删除成功!'\n                  })\n                })\n          },\n          err => {\n            this.$message({\n              type: 'error',\n              message: err\n            })\n          })\n      this.$refs.serverListTable.$refs.listTable.clearSelection()\n    }\n  }\n}\n\n",null]}