{"remainingRequest":"/data/software/vue_middleware_platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/data/software/vue_middleware_platform/src/components/page/perm/users/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/data/software/vue_middleware_platform/src/components/page/perm/users/index.vue","mtime":1607932802579},{"path":"/data/software/vue_middleware_platform/node_modules/babel-loader/lib/index.js","mtime":1607932810881},{"path":"/data/software/vue_middleware_platform/node_modules/cache-loader/dist/cjs.js","mtime":1607932810847},{"path":"/data/software/vue_middleware_platform/node_modules/vue-loader/lib/index.js","mtime":1607932810803}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { getUserList, createUser, updateUser, deleteUser, updateUserGroup, changeUserPass } from '@/api/users'\nimport { getGroupList } from '@/api/groups'\nimport UserList from './user-list'\nimport UserForm from './user-form'\nimport UpdateUgroup from './update-ugroup'\nimport ChangePass from './change-upass'\n\nexport default {\n  name: 'User',\n  components: { UserList, UserForm, UpdateUgroup, ChangePass },\n  data() {\n    return {\n      groupList: [],\n      groupOption: [],\n      user: [],\n      dialogVisibleCreate: false,\n      dialogVisibleUpdate: false,\n      dialogVisibleGroup: false,\n      dialogVisiblePass: false,\n      loading: true,\n      passForm: {},\n      detailForm: {},\n      createString: '立即创建',\n      updateString: '立即更新',\n      totalNum: 0,\n      currentPage1: 1,\n      params: {\n        page: 1,\n        keywords: '',\n        page_size: 10\n      }\n    }\n  },\n  created() {\n    this.fetchData()\n  },\n  methods: {\n    fetchData() {\n      getUserList(this.params).then(\n        // 获取user列表信息\n        res => {\n          this.user = res.results\n          this.totalNum = res.count\n          this.loading = false\n        },\n        error => {\n          this.$message({\n            type: 'error',\n            message: error\n          })\n        }\n      )\n    },\n    handleSubmitCreate(value) {\n      // 创建用户\n      createUser(value).then(\n        () => {\n          this.fetchData()\n          this.$refs.userCreateForm.$refs.form.resetFields()\n          this.dialogVisibleCreate = false\n          this.$message({\n            type: 'success',\n            message: '创建成功'\n          })\n        },\n        error => {\n          this.$message({\n            type: 'error',\n            message: error.response\n          })\n        }\n      )\n    },\n    handleSubmitUpdate(value) {\n      // 更新用户信息\n      updateUser(value).then(\n        () => {\n          this.dialogVisibleUpdate = false\n          this.fetchData()\n          this.$message({\n            type: 'success',\n            message: '更新成功'\n          })\n        },\n        error => {\n          this.$message({\n            type: 'error',\n            message: error\n          })\n        })\n    },\n    handleSubmitUpdateUserGroup(id, value) {\n      // 更新用户属组事件\n      updateUserGroup(id, value).then(\n        () => {\n          this.dialogVisibleGroup = false\n          this.fetchData()\n          this.$message({\n            type: 'success',\n            message: '更新成功'\n          })\n        },\n        error => {\n          this.$message({\n            type: 'error',\n            message: error\n          })\n        }\n      )\n    },\n    handleUpdate(value) {\n      // 更新用户弹框显示\n      this.dialogVisibleUpdate = true\n      this.detailForm = value\n    },\n    handleUpdateGroup(value) {\n      // 更新用户属组\n      this.groupList = []\n      this.detailForm = value\n      this.dialogVisibleGroup = true\n      getGroupList().then(\n        // 获取所有用户组列表\n        res => {\n          this.groupOption = res.results\n        }\n      )\n      this.groupList = value.groups.map(item => item.id)\n    },\n    handleDelete(id) {\n      deleteUser(id).then(\n        // 删除用户\n        () => {\n          if (this.totalNum % this.params.page_size === 1) {\n            this.params.page = this.params.page - 1\n          }\n          this.fetchData()\n          this.$message({\n            type: 'success',\n            message: '删除成功!'\n          })\n        },\n        err => {\n          this.$message({\n            type: 'error',\n            message: err.response.data.detail\n          })\n        }\n      )\n    },\n    handleChangeUserPass(id, value) {\n      // 修改用户密码\n      changeUserPass(id, value).then(\n        () => {\n          this.dialogVisiblePass = false\n          this.fetchData()\n          this.$message({\n            type: 'success',\n            message: '修改成功'\n          })\n        },\n        error => {\n          this.$message({\n            type: 'error',\n            message: error.response.data\n          })\n        }\n      )\n    },\n    handelChangePass(value) {\n      // 修改密码弹窗\n      this.dialogVisiblePass = true\n      this.passForm = value\n    },\n    handleChangePassCancel() {\n      this.dialogVisiblePass = false\n      this.fetchData()\n    },\n    handleCreateCancel() {\n      // 创建用户取消按钮\n      this.dialogVisibleCreate = false\n      this.fetchData()\n    },\n    handleUpdateCancel() {\n      // 更新用户取消按钮\n      this.dialogVisibleUpdate = false\n      this.fetchData()\n    },\n    handleGroupCancel() {\n      // 更细属组取消按钮\n      this.dialogVisibleGroup = false\n      this.fetchData()\n    },\n    handleCurrentChange(val) {\n      // 分页\n      this.params.page = val\n      this.fetchData()\n    },\n    handleFilter() {\n      // 搜索\n      this.params.page = 1\n      this.fetchData()\n    }\n  }\n}\n",null]}